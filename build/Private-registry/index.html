<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Private-registry" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">Private-registry | K3S Rocks</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://k3s.rocks/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://k3s.rocks/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://k3s.rocks/Private-registry"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Private-registry | K3S Rocks"><meta data-rh="true" name="description" content="Private container registry"><meta data-rh="true" property="og:description" content="Private container registry"><link data-rh="true" rel="icon" href="/img/icon-black.svg"><link data-rh="true" rel="canonical" href="https://k3s.rocks/Private-registry"><link data-rh="true" rel="alternate" href="https://k3s.rocks/Private-registry" hreflang="en"><link data-rh="true" rel="alternate" href="https://k3s.rocks/Private-registry" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.a8ad30a2.css">
<script src="/assets/js/runtime~main.a5f65e9c.js" defer="defer"></script>
<script src="/assets/js/main.1e45daa6.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/icon-green.svg" alt="K3S Rocks Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/icon-green.svg" alt="K3S Rocks Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">K3S Rocks</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/install-setup">Install Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/External-load-balancer">External Load Balancer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/First-deploy">First Deploy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/https-cert-manager-letsencrypt">HTTPS with Cert-Manager and Letsencrypt</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/traefik-dashboard">Traefik</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Basic-auth">Basic Auth</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Auto-healing">Auto Healing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Persistent-Storage-Longhorn">Persistant storage with localstorage and longhorn</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/Private-registry">Private-registry</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/metrics">Metrics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/logging">Logging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Argocd">ArgoCD</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/keel">Keel</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/plausible-analytics">Plausible analytics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Erpnext">EPRnext</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/technitium-dns">Technitium dns-server</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/uptime-kuma">Uptime-Kuma</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Faq">F.A.Q.</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Private-registry</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Private-registry</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="private-container-registry">Private container registry<a href="#private-container-registry" class="hash-link" aria-label="Direct link to Private container registry" title="Direct link to Private container registry">​</a></h2>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="using-private-registry">Using private registry<a href="#using-private-registry" class="hash-link" aria-label="Direct link to Using private registry" title="Direct link to Using private registry">​</a></h2>
<p>Using a registry besides docker hub, requires us to create a file on each node that should access it. (Usually every node)<br>
<a href="https://rancher.com/docs/k3s/latest/en/installation/private-registry/" target="_blank" rel="noopener noreferrer">rancher docs</a></p>
<p>Since the registry will require inputting values into a file on each server, it could be a good idea for it to have its own credentials.</p>
<ul>
<li>Install htpasswd if you do not have it</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apt install apache2-utils -y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-the-secret">Create the secret<a href="#create-the-secret" class="hash-link" aria-label="Direct link to Create the secret" title="Direct link to Create the secret">​</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># You should replace the username and password with more secure ones</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export REGISTRY_USERNAME=username</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export REGISTRY_PASSWORD=password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF | kubectl apply -f -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: registry-basic-auth-secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  users: |2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $(htpasswd -Bbn $REGISTRY_USERNAME $REGISTRY_PASSWORD | base64)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configure-the-nodes-to-use-the-local-registry">Configure the nodes to use the local registry<a href="#configure-the-nodes-to-use-the-local-registry" class="hash-link" aria-label="Direct link to Configure the nodes to use the local registry" title="Direct link to Configure the nodes to use the local registry">​</a></h2>
<p>**Note: ** This has to be done on every node that will pull containers</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF &gt; /etc/rancher/k3s/registries.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mirrors:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  registry.${DOMAIN}:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    endpoint:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - &quot;https://registry.${DOMAIN}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">configs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;registry.${DOMAIN}&quot;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auth:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      username: ${REGISTRY_USERNAME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      password: ${REGISTRY_PASSWORD}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># check to see</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat /etc/rancher/k3s/registries.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Restart K3S for this to take effect</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart k3s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="alternatively">Alternatively<a href="#alternatively" class="hash-link" aria-label="Direct link to Alternatively" title="Direct link to Alternatively">​</a></h2>
<p>You can add a secret like this and add it to the deployment</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create secret docker-registry my-private-registry \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--docker-server=registry.${DOMAIN} \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--docker-username=&quot;username&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--docker-password=&quot;password&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--docker-email=something@randomhere.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> system</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">web</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> system</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">web</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> system</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">web</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> system</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">web</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> registry.$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">DOMAIN</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">/system</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">web</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">imagePullSecrets</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> secret</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">docker</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="then-create-the-middleware">Then create the middleware<a href="#then-create-the-middleware" class="hash-link" aria-label="Direct link to Then create the middleware" title="Direct link to Then create the middleware">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat basic-auth-registry-middleware.yaml | envsubst | kubectl apply -f -</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We are planning to use a simple registry-ui for the registry. That requires us to use a cors middleware. This could be done in the registry settings as well, but its convenient to use the traefik ingress to solve this.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat registry-cors-middleware.yaml | envsubst | kubectl apply -f -</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Then we create the registry service with cors middleware. Authentication is handled by the registry auth. (We could optionally add basic auth on the UI itself, but it would require us to enter two sets of credentials. One for the UI and one for the registry)</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat registry-ephemeral.yaml | envsubst | kubectl apply -f -</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Finally the registry-ui (optional)</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat registry-ui.yaml | envsubst | kubectl apply -f -</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img loading="lazy" alt="Registry UI" src="data:image/webp;base64,UklGRqoXAABXRUJQVlA4IJ4XAACwtACdASqwBCcBPsFgqFEnpTEjoRX5QiAYCWlu4XYBB2DNW/Q98Yg/fRB/+un/tvPpH6Fb/rexb/Yf/F7FH7M+uZ6xP+39OP0AP//wUnhn+59uH+L8LfF/7x9yvWjyJ9WupZ8z+5f6v+5+d//E8J/h1/geoL+Tf1X/Qbxjrv+i/6XqF+xn33/r+DP/kegn19/6vuAfzn+t+l3fT0Av0z6sP+F+1noh+rv/j7hgcuX2j5wKJ7+Q76x8aJT31j40SnvrHxolPfWPjRKe+sfGiU99YGIdiRZS4terYq3zh4FIYQJKjzh9hk3jYJCaUrbcIZ5JOymiBKEsA6hwC93WvGluwPg2s6JpgZarDbgBOiR/V1teodrDIt1GcgxBSIYxhjDNMduP/DS8GMM0x24/8NLwYwzTHbj/w0vBhDiGTNrXKW/ce/1ulWkHEYS9+/YSJoX3GGMMzGZJo7iCVNY2bwIj/dQjonEECn8xS6M2RwQ0igb+u6/FiHJ4dNZaWiU99Y+NEp76x8aJT31j40Snvq82FPcWcMCBEQrnLMAx7KZJpypaAluOrRQdvHY48RuXZ5Esj/qqXOH/VUubGJqpsogTVTZRAmqmyiBNVNlECaqbKIE1U2UQJqpsogTVTZRAmqmyiBNVNlECaqbKIE1U2UQJpBc2MTVTZMYmqmyiBMjr03paz85iGi4HTelrPzmIaLgdN6Ws/OYhouB03paz85iGi4HTelrPzmIaLgdN6Ws/OYhouB03paupLRpJvoCx8aJT31j40SnvrHxolPfWPjRKe+sfGiU99Y+NEp76x7vNG5hFcyOlHNNIVOp8cJfjSeGLxSpPLYGcQsA+cCie/kO+sfGiU99Y+NEp76x8aJT/3NrWTZNASIGPAl+TJ6GxBt+OwunnN0PGHZBW1M4x/sjFitOGjLerCSWIq5y5VAk3i9cM8ANwBUWzRWiEIcapeYadu8iq0V9DKENvIAv9atvnNK53CzgqVi2MYOxrq5irEtPhZWY3aR787VOg5DQzsAChuVXZh3G87gOEFrzVr0Sc0wGZlw6lzTHFwMC3WWcn8GSmzIMad2X+FdGoYYosVp505Rz+DzdBgcdK18hOgB1RwKJ7+Q76x8aJT31j40SnvrHxolPhx7rJUZKkL/PHB1o1QhILljJEFy7CnoJPiH67K3NTRvSlN/DrMFzcFVMt/wIb5H0yJgq+c0qRgKwZbqxN0U8gCmEM78h31j40SnvrHxolPfWPjRKe+sfGxte0OFlneSCoJaQ6j2dKAqivuDbPxHaXcjwC35d9aJlr/36+EGqKMWHiZbRfPjRRTJolPfWPjRKe+sfGiU99Y+NEp76x8mttP7l/R/S11aWiU99Y+NEp76x8aJT31j40SnvrHxolPfWPjRvkYzlJ6Atd/j9cIr7/rhFff9cIr7/rhFff9cIr7cSmY0Qivv+uEV9/1wivv+uEV9/zcmXcT4ctVVArrEJNOdwakda7/H64RX3/XCK+/64RX3/XCK+/64RX3/XCK+/64RX3/XCK+1Z6EfIAZ8Ri6cYGICTLftnDaFXfkxIAvr3cKTMpaWiU99Y+NEp76x8aJT31j40SnvrHxolPfWPjRJyi/5CjkT9oVTbv5G/2YdgUEYZVHgZa8mhkwQrwDIUdiOtd/j9cIr7/rhFff9cIr7/rhFff9cIr7/rhFff9cIr7/rhEvmMhq/ACsCUK+Bk3uODhz9wMqreizOfuBlVb0WZz9wMqreizOfuBlVb0WZz9wMqreizOfuBlVb0WZz9wMqreizOfuBlVb0EfePt875RVL5RPfyHfWPjRKe+sfGiU99Y+NEp76x8aJT31j40SnvrHxolPfWPjRKe+sfGiU99Y+NEp76x8aJT31j40SnvrHxolPqq4MEO+sfGiU99Y+NEp76x8aJT31j40SnvrHxolPfWPjRJQAAD+/ywB+eJ/P0h2EIjmD0IYsgFkAsgFkAsgFkAsgFkAsgFkAsgFkAsgFkAsgFkAsgFkAsgFkAsgFkAsgFkAsgFkAsgFkAsgFkAsgFkAsgFkAsgFkAsgFkAsgFkAsgFkAsgFkAsgFkAsgFkAsgFkAsgFkAsgFkAsgFkAsgFkAsgFkAsgFkAsgFkAsgFkAsgFkAsgFkAqVZL+AEe6+e3ES3rG5Tw+bjUjcDSoRLICsnB5tROgwTenk/cEb1MGmK4XIMfLOJ1ekURyUyBPTtc6dizL2Cr+uisDo6dndHG1zLBSOwBfdtyVLafEfADXVZ3ylMoFMpeSgwHUl7sOKfbO2osahugVUJirpb9j+JV2j4bcuqnS19KVO2A0laHLhhgOrDUEGUoDiOXL/C6l4mboI7M/T1Fk+Dkr/NnsIbhrEQaW7IXyTgd4B0kk1S4oXzaBQYLWhRtlkILFgz+YugDXCNwfXCaSouCK2RDJlCwda2rALZJPZRhTnjI3wo8v1OIMUY4ubXJNz6MZs2kelUz2T+g1P5Tqdy/+TiAG1ZmgiP+JgxkKbzaLHhQFcwndYp6NIAYYX0wp+FUzAuWg9VFqjMObFBpSrBbyZ/cB0FPyvC8hQxxO4pUzml9nB+UyC3OZmfGrhyPjU+EyzyMVtlSj6kE80U2KF03hX6l38UWeMRr+RvACEicqS5S0m2dKfSGHKuHwg6I0HyG/oodpWqUJI+zE6XDhob1XZfGT84i+fZ5atGCdIiD0dmTGwkbq9FgR/qUFWkEVlgLC+30vGeXSOmBU97U27JkR3BAtotpdIaNTnayQh/0JlXmOhsN65LsUvXOlh9QN9IHQRf69Ze/ugVrm8uJat7QoYnXW7AXwOpZUYiETSUos7axVVnlNbPqD2m+Zt8b6oLTfKgsshCT5XwaM1zCaxf3JXESN49Jpf8KPciCijnMo0NcD6mNbfEob0WNeOtrOc/St682sSGaBJlld3gnB0i2H0sDI6Uut4unKbOB0H7tRXWbBBjtcz+Xh2F2xAZVSzQqtIMSDaPM00SNbwLemxKISIdghkMOORK6yNhdNpc17Bnc6S4/+PQ6QnIM5XpAqmxZ8bN6N1enaZZw/4+42tvSeir1icWVvrZi4frer6ERzcAAAAAAAAAABl7sxdHhClc0zv57wGsgxjLQ/E6Iy52XXZKongExS9dZz6/prUopiSrc+ZB7F0uVSUJmbx0uHtgfkCV2HxjpYUQO1u7sEoou8RDGVXKPoYnow4nDPLvcMgqhxteGp944trUCegug1U3KznXXdP1L0Ej2J/ZcXKX0RKyPudMG42gIMY1+GCYfEfD5qOwcjWH/rIdXcxPhKZTq7rcPc4FA5DzhKweWrvEa3t68h/yGYew6BATrCWKZpKQhlrweKrtV844q9XMAZYsiIU/ZxpYh0tz0kJXHUGVBY5bQgRCFbE0SbLsECGbclJsncukhNxZ/wJ5/DYply3RqyJTMjxsbadHhATph0C+4przAOB5YDHQWPGxg8avMXjlh3HxRlDdqch/d2FYv2QtdIyuoNwoAACFT+1XLCbKGembqPkwkgPR0+yi6gCbQJI0ynZ7Ko3bTx4tPAhqSNYa/yx58osBmDFbchr5LVC0uXooIOgD65azCFH0X13WAswCvolINZESejjqsvr2jTWVONIoAAAAiujG/pcfYiAICgZ2j8St1VE9XmOeXa6AAAABJ2wQcQfcvgYsBBY3tQQAAAAJeFtTpRRIcrdxF4rCxt+AbB8v0BFnhgd6gUfw81aAnJZm4mDTZqTfJoQQsa2sbLFsqHbnfyhn5Yg9WyxgcKr0obKEc907KaUUQOMPvEH9d1kcVV+xLuAP23CJ3RkqHVOc6KSSNWRiJplDRHEEjKLwC1bM9L1CGpxTAAACF73weg8DDFNmGHjWAhy6Xil30hl5UhTWiqbggYAogmlq2roEjoQv0+UW0i8sJR5P3xkK46fLBn0lYfQCZSGLhXZsB6UsJbjjp9AarTyu8RslczG/tu5eN13Q9799+vq9G0xFH07OdhWEA26Gv5D9jTgcy4SjmgAiiIL3G26t/pIZrPyLjGQJIRQZsjFQr7FTE+E0Ied4a6PekY9DrdYKOHb4EMqA4b47NVROaagqq1ArCojG5H4O/8oOoObxEjOf0LD+Dqd9fNvsR+JjNEewjc9t+Uqr26jX/MxfVbxk0gNe0vCyVBolstU0nSXtEo+7rMaYBU/lBG2A8onwHL2io5S/qnMA2WLwhoviL0VjntVpPR/1NSijz9cm109WVE1MDe0l725/ap34bKKvKuJri18AMercyd9J44/3ELqHFiqWD0k+vfLEllxwH1hUbz3dq7E1EqzYzzMuDmc5hSBD5IlkvOOCyMaVw4gWpeiQNhz7yj5q+SNw47eddgwoanZ4CtVjuEfuUZEXxUVaPu4GdmwiFvfMEh3V3C02LZDM1tnv/p74Z+slnBMuL3U3wFvmldbCgAqhBz8u6Mh5nkSj414HNnj5uvnKf7//OjVKj8Uouvy8DflaAFi+k3iXSS6IFJsgJmf4qwxuFaKUSdM4a/zlat+2r81f8plrw7pyjnsxuw3H0xi1ec6ZSsVhFaQ0ju6kJ9b1J3LfjK+0lhZ4SsjdolKmV9pViLaoVAZr1fjz/Py3an4xMwWHSKwu+o8udL6YuniWJUb5r0Annypbf+rPl7b8MC0RrF30dLWrOZZH2DdlDzZfZ1pgD2NG/KlSYYfFFTlzPdJAdFibiYrIBlj7D9SMHkS784pi3k30xRC0IH+a6kP+pA7A9AsNlrC7VCane+gpN3VmZdVooz0kUmq17GqXIUdrbuCH8gNie+AIpT4KNtfpDO9tv0u4mQgnTajx9JM2UDcg+gpjcvwM4QUEvdDOB8tFieJU/kJL/sxBrw+pgQKqVRsD2Gz3Kf6VVNR19/8D1DAv1rrfl7O6erPXZM2pn05E2fhm4FcibhQzeYxNv1tRPWF1RdNXXcRGpe6/D5gBJgSYoLHKU5P3vlJ5CQPE0DzsMfM9ElbNuLZzZN/MRaf/pKXmxEa2+tgD+vXjZqpx2aiXgTDlC7J+NGMwyg3ngx7xX+ZJu0LcUFVzpYTU0nf0DqqNzvy7gvkTmmWQKxPdl7jzqru16z31pUIhDEyBknsqgDc5Hn6Mpb66sT3D5N1bkmwjC5WD/ZJZdNbc+6mTY7YPSHumhJCYbpEuh6H4cWgq2BiebYeUVyK6NqMoce9B2xgF+8zMTNaZtBv5lLA6JQ12z3jZP13kVuqjuAeyCGNiRMVLxUpXCFX9f/t2w6fkk6G6QPBBovK8nfrVEDyppwNkIROa+e3boPhxdzCW6rjS0ZwWpID0QHIxWKLOSgqyea/vIyRMsXGwVm41H2yBgsZKOm3d4bbHiLzvtygJppiQHWamRtFU5rxW2NOgr59Ixg3GkrLd/oVa7JILrh7ONDIfVM/mwSIeZsu5JCNJtsiqvh2SlymjJHEEnTyQdHaE39SHZjYrvB1MQgComp4qE3gi9RcM5s94XHAMdQfZ2UpPQunauF207lVRcNMX+6a4uwbQb1oePh/biwnN+1w+MuFek3QscJGgXO791FjQlACnLVCrBGZV1KcMGvOKORFJEbK7BM7q1NOPMIrwRTNSmERXdK+3Fx3Vijo0kHSNOxXS2aFWxl6NkMkxWRNjVK5Quh5gZPoFjRw21dQSBW2AHLeedr1IqdSB40ViZyxmyaQxQeiWd3aM2LQZQlV0blZyVoZP6mDjT5IAd+dYNE0FDXvZWeOrdJcDn3RORPelbFDu75uQio9aa97XM4+kNNaxBplcGfXSOL0ArW1XA2QlzygIDDFA4tla58AcF3w4wN9j6/2GSNqglmTyet3MweoMF7CQAr1smszGd6ybXjfO9c7Rqn2CpCweihdsO5sGD3DXpjICY9SXEAWrsh1dzooWAlUIIR9pnkvB8/XhMy9dl6+fKBDLr7HQ99Eq1q5BCIMY4nxG5yS8yya2A3lOrBDaF729PZO5CCg1mahJyEeXxzJd2ihTfcoZCFUftd4e0rJPHRt21q+1yrGEqo8dsBPBLgMfMH2+QhTvlZYw5/1+siPg/XL0yuQ2u0YikuMhEavVbZYhieaICoTv6U4Fwk0KRTMqIoFIHefMoJLwSHZpsEbhInmJIGIXnLuCI4lGDDFrhMVFAgoTT2XK2+dtKufFuPrv716qnvHUSuUbcg/90wTsmPPER6hijRjMZ+9Tm2ZiHZlNHiRAOYjNJarxSP6+VEmrMijOBJFf+j0kxIcw5bZH+LsixsFFU2zD/xGZKAU8Lur1lgz97yvkMXhcdJRAAAABm3nfdMfxxIVbnZ3f394/8FR24SV6Jp/tIqWxVKEHM+50EPX0tOqEcUKFqBbgXYxTpj4ziSmcXzyyphLM3dYNtFyWe+IsffdWEC6mvFctC9EDAJHj+CxHtYy8k0bQc+xrD7ChGqjkrw1TBNggID9L2lRQHmchagCFZOFPuA6luDUSLIk1lNXZL0lubptu75wf/rrY3EeRnCWYgxQVxwOgAdnM6FncYoHdcUby1zdrUaC+y9HuSLHNtE+tD/7sh3YVmU2xv+1sJLdqsQJJR6vkmi8Lr05mTDr4QEW6A78KfY4UlsuJXUXGl+A483Gn1ans/07CrmOkRJN25ahTtQA4AH9wwzFJErUXmlrXPPAQC1Y5nDpkXnW332jHpNFobm7ea77Rzc7nIV2gJJs9P3M4kY9pylM3Qu4LDZoZCId1/OOODtvknu3xDdwRFi7vWonJXRyZOyxv3bvAETX52UMtqivUG/HbfQiYuo/XcT3E1jIrdSrcCddp9d8MyZj3XU+eb2AdxH/7JmHnzs6B+zgaI9E8bdbplX8ote8FFR5yTwsDffR4Uzv7bhbqr1LoNRmuXDbF0DkE7is3+ZG0fdbNtWpaULB26QdsDgPPCMxRIj89MkRMYZn+amNi5G5kIf16fw3P7u7u/6MziRQlmUFXMCJcjV7S3LHzlr4Guh2D/CB6EbD3h4leUvwWrRzz4nCMamgJUlvASV60c8zJArTB2k7kKXn4O1kVJXP9mgeEp0ggIYU6ClAt4B1Ue9KUKoBSWjldIksCb5Y8IoCXLZgPdrOl2TtrgVVlTld2q2PG/WhhvfIoB3ZhtwInaGUr4Gf5i2ihV0AAAAAM/Sv+n26CLN6CPv8FJ3vO3vwaWsOuf8on4AZhMLcjsfEFBKqpXJuL4N4TCJPIogRtPojr34Oct8zqbcdKXeHp0iNGBCXD8d5TPrWlvQKkw6HXH90KdGv9pJxQmOTQaP7UvmUD/G3t+35Ya2/fKdKdAWTP0PuElvrDLlwiraLaiTsNmIsfbEzrSNcZanCNu4zWC+QhZ6hA7O0ltCtwz1IFNw3kEgha+E20bT6Z6noofyIgkSA2YKx1wrDiqZqWqf8mCusheR/8KNGKdGJPSHde3i0EU6LbldIhk4uNS7XXOVRDC0peGkX9nJFqAr3/Z2yO0wTEYABTM5TZ724w4Ahe5OS3XgqQEkCZbaqbv6czmTaHBDvOYU8QfhWgeuoQUE7KnvYPgQYhC/WtNnr82rZMxLZDHqJ6dTjr1Ygl5xrtULwXrYunPF/kE66aK9p/PWgAWDGfall8fwPrmGfrdjAEqIAAAAE73hAAAAAvsfnc7OOXyPv3OAALkRYAAuxhz8KyrpdHBFCaWLYAAAAC5pzn1NE93W0gKoBcapzXFZWFkBbYOxlYbGHC1J2reHNEpr/sJEf1REAGlSnK8671Mw2C2azC4g12p+JeGy1rn/DjgPP2NgkpPmm8lI+bciI2EmdZY8QtYZyxH0E9qf3LO/rifVysSv6NViKtd1UQyEH/BocZ5lHAnCQzM1UQJ5yA7YJ7io566Rwlbq6wwE3sWhyPfCW0KJn8eVIcTwVwITGIcIB28b6/F64Q6FiyX1K4pmufu7weGP+v8crj8nCutetEAAAACJ1iMG+Z0iHEnzF3pi5cu394lIGBE8fjNucPMAN/5t+R5/auPy1G/nyj1axwhFO7inw3i9rD/2f3qtoUzy72UeG7n8R/dHW2hpei/bP1ugtj0cAAAAUzVLhpt2N4AAAAAQO/FrAgAAAAAAAAAAW2kwAAAAAAAA" width="1200" height="295" class="img_ev3q">
For the registry UI, we will use the same basic auth middleware as for the registry, as the registry-ui forwards the credentials. If you use a different basic auth middleware here then you will best case have to enter two sets of credentials. So its better to just have the same as the registry.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="test-the-registry">Test the registry<a href="#test-the-registry" class="hash-link" aria-label="Direct link to Test the registry" title="Direct link to Test the registry">​</a></h2>
<p>On any machine with docker:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker login registry.${DOMAIN}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Username: username</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Password: password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># (The registry credentials)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker pull nginx:latest</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker tag nginx:latest registry.dog.example.com/nginy:later</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker push registry.dog.example.com/nginy:later</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The push refers to repository [registry.mydomain.com/nginy]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">f0f30197ccf94: Pushed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">e23424ff930d4: Pushed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c9732d7567184: Pushed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4b8db2d43325a: Pushed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4312341684c4a: Pushed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">02c055fgh42f5: Pushed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">latest: digest: sha256:eba373a0620f68ffdc3f4327041ad25e2342175b8feb35b992574cd83698e9e3c size: 1570</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="add-persistance">Add persistance<a href="#add-persistance" class="hash-link" aria-label="Direct link to Add persistance" title="Direct link to Add persistance">​</a></h2>
<p>If everything looks allright you might want to consider adding some persistance to that registry.</p>
<ul>
<li>Delete the ephememeral deployment/service/ingress</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat registry-ephemeral.yaml | envsubst | kubectl delete -f -</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Create the longhorn (or localhost) PVC</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat pvc-registry-longhorn.yaml | envsubst | kubectl apply -f -</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Create the longhorn (or localhost) deployment/service/ingress</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat registry-longhorn.yaml | envsubst | kubectl apply -f -</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="build-push-and-deploy-to-the-registry">Build, push and deploy to the registry<a href="#build-push-and-deploy-to-the-registry" class="hash-link" aria-label="Direct link to Build, push and deploy to the registry" title="Direct link to Build, push and deploy to the registry">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="install-docker">Install docker<a href="#install-docker" class="hash-link" aria-label="Direct link to Install docker" title="Direct link to Install docker">​</a></h3>
<ul>
<li>Install Docker following <a href="https://docs.docker.com/install/" target="_black">the official guide</a>...</li>
<li>...or alternatively, run the official convenience script:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Download Docker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -fsSL get.docker.com -o get-docker.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Install Docker using the stable channel (instead of the default &quot;edge&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CHANNEL=stable sh get-docker.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Remove Docker install script</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm get-docker.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="build-the-container">Build the container<a href="#build-the-container" class="hash-link" aria-label="Direct link to Build the container" title="Direct link to Build the container">​</a></h3>
<ul>
<li>Go the the /apps/system-info-web folder</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd ../apps/system-info-web/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Build the container</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker build -t registry.${DOMAIN}/system-info-web .</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Push the container</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker push registry.${DOMAIN}/system-info-web</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Deploy it</li>
<li>Go back to the manifests folder if neccesary</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd ../../manifests</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Deploy</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat system-info-web.yaml | envsubst | kubectl apply -f -</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="check">Check<a href="#check" class="hash-link" aria-label="Direct link to Check" title="Direct link to Check">​</a></h3>
<p>Go to <a href="http://sysinfo.dog.example" target="_blank"><a href="http://sysinfo.dog.example" target="_blank" rel="noopener noreferrer">http://sysinfo.dog.example</a></a> To see if it has worked.</p>
<p><strong>Note:</strong> See the value under <strong>&quot;hostname&quot;</strong> which is the name of the pod running the service. In the deployment yaml it has been specified with 2 replicas. Try refreshing and see that this value will change as the ingress is now load balancing between the two replicas.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/Persistent-Storage-Longhorn"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Persistant storage with localstorage and longhorn</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/metrics"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Metrics</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#private-container-registry" class="table-of-contents__link toc-highlight">Private container registry</a></li><li><a href="#using-private-registry" class="table-of-contents__link toc-highlight">Using private registry</a></li><li><a href="#create-the-secret" class="table-of-contents__link toc-highlight">Create the secret</a></li><li><a href="#configure-the-nodes-to-use-the-local-registry" class="table-of-contents__link toc-highlight">Configure the nodes to use the local registry</a></li><li><a href="#alternatively" class="table-of-contents__link toc-highlight">Alternatively</a><ul><li><a href="#then-create-the-middleware" class="table-of-contents__link toc-highlight">Then create the middleware</a></li></ul></li><li><a href="#test-the-registry" class="table-of-contents__link toc-highlight">Test the registry</a></li><li><a href="#add-persistance" class="table-of-contents__link toc-highlight">Add persistance</a></li><li><a href="#build-push-and-deploy-to-the-registry" class="table-of-contents__link toc-highlight">Build, push and deploy to the registry</a><ul><li><a href="#install-docker" class="table-of-contents__link toc-highlight">Install docker</a></li><li><a href="#build-the-container" class="table-of-contents__link toc-highlight">Build the container</a></li><li><a href="#check" class="table-of-contents__link toc-highlight">Check</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 K3S Rocks. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>