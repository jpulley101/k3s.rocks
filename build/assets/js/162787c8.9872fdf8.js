"use strict";(self.webpackChunkk_3_s=self.webpackChunkk_3_s||[]).push([[996],{5671:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var t=s(5893),a=s(1151);const i={sidebar_position:16,sidebar_label:"EPRnext"},r=void 0,l={id:"Erpnext",title:"Erpnext",description:"Erpnext",source:"@site/docs/Erpnext.md",sourceDirName:".",slug:"/Erpnext",permalink:"/Erpnext",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:16,frontMatter:{sidebar_position:16,sidebar_label:"EPRnext"},sidebar:"tutorialSidebar",previous:{title:"Plausible analytics",permalink:"/plausible-analytics"},next:{title:"Technitium dns-server",permalink:"/technitium-dns"}},d={},c=[{value:"Erpnext",id:"erpnext",level:2},{value:"Add repo",id:"add-repo",level:2},{value:"Create namespace",id:"create-namespace",level:2},{value:"Install with helm",id:"install-with-helm",level:2},{value:"Watch creation",id:"watch-creation",level:3},{value:"Create a new site template",id:"create-a-new-site-template",level:2},{value:"Apply the templated manifest",id:"apply-the-templated-manifest",level:2},{value:"View site creation",id:"view-site-creation",level:3},{value:"Add ingress",id:"add-ingress",level:2},{value:"Without tls",id:"without-tls",level:3},{value:"Apply ingress",id:"apply-ingress",level:4},{value:"Add fake domain to /etc/hosts",id:"add-fake-domain-to-etchosts",level:4},{value:"Go to site",id:"go-to-site",level:4},{value:"With tls",id:"with-tls",level:3},{value:"Note",id:"note",level:4},{value:"Set environment variables",id:"set-environment-variables",level:4},{value:"Apply manifest",id:"apply-manifest",level:4},{value:"Go to site",id:"go-to-site-1",level:4},{value:"Credentials",id:"credentials",level:3},{value:"Enjoy",id:"enjoy",level:3}];function o(e){const n={a:"a",br:"br",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",img:"img",p:"p",pre:"pre",...(0,a.a)(),...e.components},{Details:i}=n;return i||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"erpnext",children:"Erpnext"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.img,{alt:"erpnext",src:s(490).Z+"",width:"1177",height:"680"}),"\nPicture from ",(0,t.jsx)(n.a,{href:"https://erpnext.com/",children:"erpnext.com"})]}),"\n",(0,t.jsxs)(n.p,{children:["To keep in line with the instructions in the erpnext ",(0,t.jsx)(n.a,{href:"https://github.com/frappe/helm",children:"helm repo"}),", we will be using helm and namespaces."]}),"\n",(0,t.jsxs)(n.p,{children:["Note, make sure ",(0,t.jsx)(n.a,{href:"/install-setup/#add-longhorn-optional",children:"longhorn"})," is installed. It is possible to avvoid it by pre-creating a local-storage pvc and referencing it in ",(0,t.jsx)(n.code,{children:"erpnext_values"}),", but for testing I found it easier to install longhorn and reference it as storageClass instead. This way you will have RWX (the volume cna be mounted as read-write by many nodes) compatible volumes ready for scaling as well."]}),"\n",(0,t.jsx)(n.h2,{id:"add-repo",children:"Add repo"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"helm repo add frappe https://helm.erpnext.com && \\\nhelm repo update\n"})}),"\n",(0,t.jsx)(n.h2,{id:"create-namespace",children:"Create namespace"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl create namespace erpnext\n"})}),"\n",(0,t.jsx)(n.h2,{id:"install-with-helm",children:"Install with helm"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"helm install frappe-bench -n erpnext -f erpnext_values.yaml frappe/erpnext\n"})}),"\n",(0,t.jsxs)(i,{children:[(0,t.jsx)("summary",{children:"erpnext_values.yaml"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'--8<-- "./manifests/erpnext_values.yaml"\n'})})]}),"\n",(0,t.jsx)(n.h3,{id:"watch-creation",children:"Watch creation"}),"\n",(0,t.jsx)(n.p,{children:"Wait for the containers to be created and settle down"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl get pods -n erpnext --watch\n"})}),"\n",(0,t.jsx)(n.p,{children:"You should eventually see something like this"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"NAME                                                   READY   STATUS      RESTARTS      AGE\nfrappe-bench-erpnext-conf-bench-20230204220652-rjtxx   0/1     Completed   0             100s\nfrappe-bench-erpnext-gunicorn-7989dfb6c8-p7njf         1/1     Running     0             100s\nfrappe-bench-erpnext-nginx-684d567845-5f845            1/1     Running     0             100s\nfrappe-bench-erpnext-scheduler-86648bd8d7-h6vrf        1/1     Running     3 (62s ago)   100s\nfrappe-bench-erpnext-socketio-75bd4648b6-gsbqx         1/1     Running     3 (49s ago)   100s\nfrappe-bench-erpnext-worker-d-74f5b8fdd4-xg6rp         1/1     Running     3 (55s ago)   100s\nfrappe-bench-erpnext-worker-l-5dcbbc79d8-8bd8g         1/1     Running     3 (51s ago)   100s\nfrappe-bench-erpnext-worker-s-54968545c4-2mtkv         1/1     Running     3 (59s ago)   100s\nfrappe-bench-mariadb-0                                 1/1     Running     0             100s\nfrappe-bench-redis-cache-master-0                      1/1     Running     0             100s\nfrappe-bench-redis-queue-master-0                      1/1     Running     0             100s\nfrappe-bench-redis-socketio-master-0                   1/1     Running     0             100s\n\n"})}),"\n",(0,t.jsx)(n.h2,{id:"create-a-new-site-template",children:"Create a new site template"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"helm template frappe-bench -n erpnext frappe/erpnext -f erpnext_newsite_values.yaml -s templates/job-create-site.yaml > erpnext_newsite_manifest.yaml\n"})}),"\n",(0,t.jsx)(n.p,{children:"The values:"}),"\n",(0,t.jsxs)(i,{children:[(0,t.jsx)("summary",{children:"erpnext_newsite_values.yaml"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'--8<-- "./manifests/erpnext_newsite_values.yaml"\n'})})]}),"\n",(0,t.jsx)(n.p,{children:"Templated manifest:"}),"\n",(0,t.jsxs)(i,{children:[(0,t.jsx)("summary",{children:"erpnext_newsite_manifest.yaml"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'--8<-- "./manifests/erpnext_newsite_manifest.yaml"\n'})})]}),"\n",(0,t.jsx)(n.h2,{id:"apply-the-templated-manifest",children:"Apply the templated manifest"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl apply -n erpnext -f erpnext_newsite_manifest.yaml\n"})}),"\n",(0,t.jsx)(n.h3,{id:"view-site-creation",children:"View site creation"}),"\n",(0,t.jsx)(n.p,{children:"Get jobs"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl get jobs -n erpnext\n"})}),"\n",(0,t.jsx)(n.p,{children:"Result"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"NAME                                             COMPLETIONS   DURATION   AGE\nfrappe-bench-erpnext-conf-bench-20230204220652   1/1           70s        9m25s\nfrappe-bench-erpnext-new-site-20230204221209     0/1           8s         8s\n"})}),"\n",(0,t.jsx)(n.p,{children:"Get logs for the job"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl logs job/frappe-bench-erpnext-new-site-20230204221209 -f -n erpnext\n"})}),"\n",(0,t.jsx)(n.p,{children:"Result"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'Defaulted container "create-site" out of: create-site, validate-config (init)\n\nInstalling frappe...\nUpdating DocTypes for frappe        : [========================================] 100%\nUpdating country info               : [========================================] 100%\nUpdating Dashboard for frappe\n\nInstalling erpnext...\nUpdating DocTypes for erpnext       : [========================================] 100%\nUpdating customizations for Address\nUpdating customizations for Contact\nUpdating Dashboard for erpnext\n*** Scheduler is disabled ***\n\n'})}),"\n",(0,t.jsx)(n.h2,{id:"add-ingress",children:"Add ingress"}),"\n",(0,t.jsx)(n.h3,{id:"without-tls",children:"Without tls"}),"\n",(0,t.jsx)(n.h4,{id:"apply-ingress",children:"Apply ingress"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f erpnext_notls_ingress.yaml -n erpnext\n"})}),"\n",(0,t.jsx)(n.h4,{id:"add-fake-domain-to-etchosts",children:"Add fake domain to /etc/hosts"}),"\n",(0,t.jsx)(n.p,{children:"Add something like this to the last line (use your server ip and desired fake hostname):"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"12.345.67.89 erpnext.k3s\n"})}),"\n",(0,t.jsx)(n.p,{children:"or with a commmand:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo -- sh -c \"echo '<server ip> erpnext.k3s' >> /etc/hosts\"\n"})}),"\n",(0,t.jsx)(n.h4,{id:"go-to-site",children:"Go to site"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"http://erpnext.k3s\n"})}),"\n",(0,t.jsx)(n.h3,{id:"with-tls",children:"With tls"}),"\n",(0,t.jsx)(n.h4,{id:"note",children:"Note"}),"\n",(0,t.jsx)(n.p,{children:"If you first followed the steps above with a non tls version, you will have a site called erpnext.k3s. Erpnext expects a host header with this domain in it, and this is why we set it in /etc/hosts in the non-tls version."}),"\n",(0,t.jsx)(n.p,{children:"So when you want a tls version, you have two choices."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.em,{children:"Reinstall"}),(0,t.jsx)(n.br,{}),"\n","Edit the values in the manifests used above to something that is correct, like erpnext.your.domain.com when installing / reinstalling."]}),"\n",(0,t.jsx)(n.p,{children:"OR"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.em,{children:"Add Middleware"}),(0,t.jsx)(n.br,{}),"\n","Add a middleware that replaces ",(0,t.jsx)(n.code,{children:"erpnext.your.domain.com"})," with ",(0,t.jsx)(n.code,{children:"erpnext.k3s"})," :"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f erpnext_replace_host_header_middleware.yaml\n"})}),"\n",(0,t.jsxs)(i,{children:[(0,t.jsx)("summary",{children:"erpnext_replace_host_header_middleware.yaml"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'--8<-- "./manifests/erpnext_replace_host_header_middleware.yaml"\n'})})]}),"\n",(0,t.jsx)(n.h4,{id:"set-environment-variables",children:"Set environment variables"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"export DOMAIN=dog.example.com\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"\nexport EMAIL=name@example.com\n"})}),"\n",(0,t.jsx)(n.h4,{id:"apply-manifest",children:"Apply manifest"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cat ./manifests/erpnext_tls_ingress.yaml | envsubst | kubectl apply -f -\n"})}),"\n",(0,t.jsxs)(i,{children:[(0,t.jsx)("summary",{children:"erpnext_tls_ingress.yaml"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'--8<-- "./manifests/erpnext_tls_ingress.yaml"\n'})})]}),"\n",(0,t.jsx)(n.h4,{id:"go-to-site-1",children:"Go to site"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"https://erpnext.yourdomain.com\n"})}),"\n",(0,t.jsx)(n.h3,{id:"credentials",children:"Credentials"}),"\n",(0,t.jsxs)(n.p,{children:["username: ",(0,t.jsx)(n.code,{children:"Administrator"}),(0,t.jsx)(n.br,{}),"\n","password: ",(0,t.jsx)(n.code,{children:"secret"})]}),"\n",(0,t.jsx)(n.h3,{id:"enjoy",children:"Enjoy"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"erpnext",src:s(9585).Z+"",width:"1157",height:"849"})})]})}function h(e={}){const{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},9585:(e,n,s)=>{s.d(n,{Z:()=>t});const t=s.p+"assets/images/erpnext-login-b2389f89a687b823050f5bd985689954.png"},490:(e,n,s)=>{s.d(n,{Z:()=>t});const t=s.p+"assets/images/services-customer-18868071986ef9ebd7b46951d61485ab.png"},1151:(e,n,s)=>{s.d(n,{Z:()=>l,a:()=>r});var t=s(7294);const a={},i=t.createContext(a);function r(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);