"use strict";(self.webpackChunkk_3_s=self.webpackChunkk_3_s||[]).push([[468],{382:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>c});var o=n(5893),r=n(1151);const s={sidebar_position:19,sidebar_label:"F.A.Q."},i=void 0,a={id:"Faq",title:"Faq",description:"F.A.Q.",source:"@site/docs/Faq.md",sourceDirName:".",slug:"/Faq",permalink:"/Faq",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:19,frontMatter:{sidebar_position:19,sidebar_label:"F.A.Q."},sidebar:"tutorialSidebar",previous:{title:"Uptime-Kuma",permalink:"/uptime-kuma"}},l={},c=[{value:"F.A.Q.",id:"faq",level:2},{value:"Get &quot;http://localhost:8080/version?timeout=32s&quot;: dial tcp 127.0.0.1:8080: connect: connection refused",id:"get-httplocalhost8080versiontimeout32s-dial-tcp-1270018080-connect-connection-refused",level:2},{value:"The connection to the server localhost:8080 was refused - did you specify the right host or port?",id:"the-connection-to-the-server-localhost8080-was-refused---did-you-specify-the-right-host-or-port",level:2},{value:"cat somefile.yaml | envsubst | kubectl apply -f -",id:"cat-somefileyaml--envsubst--kubectl-apply--f--",level:2},{value:"No such file or directory",id:"no-such-file-or-directory",level:2},{value:"Node interal interface",id:"node-interal-interface",level:2},{value:"Reset node",id:"reset-node",level:2},{value:"X-Forwarded-For and X-Real-Ip (proxy protocol)",id:"x-forwarded-for-and-x-real-ip-proxy-protocol",level:2}];function d(e){const t={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",...(0,r.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.h2,{id:"faq",children:"F.A.Q."}),"\n",(0,o.jsxs)(t.h2,{id:"get-httplocalhost8080versiontimeout32s-dial-tcp-1270018080-connect-connection-refused",children:['Get "',(0,o.jsx)(t.a,{href:"http://localhost:8080/version?timeout=32s",children:"http://localhost:8080/version?timeout=32s"}),'": dial tcp 127.0.0.1:8080: connect: connection refused']}),"\n",(0,o.jsx)(t.p,{children:"Using helm with k3s can create this error.\nIt can be solved with"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"export KUBECONFIG=/etc/rancher/k3s/k3s.yaml\n"})}),"\n",(0,o.jsx)(t.h2,{id:"the-connection-to-the-server-localhost8080-was-refused---did-you-specify-the-right-host-or-port",children:"The connection to the server localhost:8080 was refused - did you specify the right host or port?"}),"\n",(0,o.jsx)(t.p,{children:"See previous question"}),"\n",(0,o.jsx)(t.h2,{id:"cat-somefileyaml--envsubst--kubectl-apply--f--",children:"cat somefile.yaml | envsubst | kubectl apply -f -"}),"\n",(0,o.jsxs)(t.p,{children:["The most basic method is to first create the file and then apply it with ",(0,o.jsx)(t.code,{children:"kubectl apply -f somefile.yaml"}),". But in this example we use the command above to replace variables in the yaml files with the content from the environment variables we set."]}),"\n",(0,o.jsx)(t.h2,{id:"no-such-file-or-directory",children:"No such file or directory"}),"\n",(0,o.jsx)(t.p,{children:"Are you sure you are in the manifests directory, (or correctly pick subfolder)"}),"\n",(0,o.jsx)(t.h2,{id:"node-interal-interface",children:"Node interal interface"}),"\n",(0,o.jsx)(t.p,{children:"Run the command below to list your interfaces. Look for the one with an address belonging to your private network."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:'ip a s | grep -i "UP\\|inet"\n'})}),"\n",(0,o.jsx)(t.h2,{id:"reset-node",children:"Reset node"}),"\n",(0,o.jsx)(t.p,{children:"To reset node run uninstall script and reboot."}),"\n",(0,o.jsxs)(t.p,{children:["From ",(0,o.jsx)(t.a,{href:"https://rancher.com/docs/k3s/latest/en/installation/uninstall/",children:"rancher docs"}),"\nTo uninstall K3s from a server node, run:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"/usr/local/bin/k3s-uninstall.sh\n"})}),"\n",(0,o.jsx)(t.p,{children:"To uninstall K3s from an agent node, run:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"/usr/local/bin/k3s-agent-uninstall.sh\n"})}),"\n",(0,o.jsx)(t.h2,{id:"x-forwarded-for-and-x-real-ip-proxy-protocol",children:"X-Forwarded-For and X-Real-Ip (proxy protocol)"}),"\n",(0,o.jsx)(t.p,{children:"It can be important to know from what ip address the request originated Analytics and rate limiting are two common cases. This is called proxy protocol."}),"\n",(0,o.jsx)(t.p,{children:"If we do not enable this in the traefik config we will see errors when we try to send requests. So we have to activate it in the traefik service. If you use a load balancer it is also important to remember to activate this setting in the loadbalancer itself, so you can benefit from it downstream."}),"\n",(0,o.jsxs)(t.p,{children:["We set the deployment.kind to DaemonSet, hostNetwork: true and web.proxyProtocol.insecure. If you are using a load balancer, it is highly recommended to use ",(0,o.jsx)(t.code,{children:"proxyProtocol.trustedIPs"})," instead, set to your load balancer ip. ",(0,o.jsx)(t.a,{href:"https://doc.traefik.io/traefik/routing/entrypoints/#proxyprotocol",children:"https://doc.traefik.io/traefik/routing/entrypoints/#proxyprotocol"})]}),"\n",(0,o.jsx)(t.p,{children:"The deamonset and hostnetwork: true makes sure there is a traefik pod running on every node, meaning any packet will be forwarded by traefik with the proxy protocol. This is only important if you expect incoming traffic on all nodes and you could consider just having traefik services on certain nodes, and only pointing the load balancer to those nodes."}),"\n",(0,o.jsx)(t.p,{children:"traefik-config.yaml (exerpt):"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-yaml",children:'spec:\n  valuesContent: |-\n    deployment:\n      kind: DaemonSet\n    hostNetwork: true\n    additionalArguments:\n      #- "--entryPoints.web.proxyProtocol.trustedIPs=123.123.123.123"\n      - "--entryPoints.web.proxyProtocol.insecure"\n'})})]})}function h(e={}){const{wrapper:t}={...(0,r.a)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},1151:(e,t,n)=>{n.d(t,{Z:()=>a,a:()=>i});var o=n(7294);const r={},s=o.createContext(r);function i(e){const t=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),o.createElement(s.Provider,{value:t},e.children)}}}]);