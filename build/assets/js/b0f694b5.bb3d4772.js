"use strict";(self.webpackChunkk_3_s=self.webpackChunkk_3_s||[]).push([[535],{1385:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>l,toc:()=>o});var r=n(5893),s=n(1151);const a={sidebar_position:5,sidebar_label:"HTTPS with Cert-Manager and Letsencrypt"},i=void 0,l={id:"https-cert-manager-letsencrypt",title:"https-cert-manager-letsencrypt",description:"HTTPS with Cert-Manager and Letsencrypt",source:"@site/docs/https-cert-manager-letsencrypt.md",sourceDirName:".",slug:"/https-cert-manager-letsencrypt",permalink:"/https-cert-manager-letsencrypt",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5,sidebar_label:"HTTPS with Cert-Manager and Letsencrypt"},sidebar:"tutorialSidebar",previous:{title:"First Deploy",permalink:"/First-deploy"},next:{title:"Traefik",permalink:"/traefik-dashboard"}},c={},o=[{value:"HTTPS with Cert-Manager and Letsencrypt",id:"https-with-cert-manager-and-letsencrypt",level:2},{value:"Letsencrypt Production ClusterIssuer",id:"letsencrypt-production-clusterissuer",level:3},{value:"Test",id:"test",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2}];function d(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.a)(),...e.components},{Details:n}=t;return n||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h2,{id:"https-with-cert-manager-and-letsencrypt",children:"HTTPS with Cert-Manager and Letsencrypt"}),"\n",(0,r.jsx)(t.p,{children:"Traefik could do https with letsencrypt on its own. But the added features we get from cert-manager are worth it, so we'll go with that. Most noteworthy is certificate sharing between nodes and pods."}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Note:"})," Make sure you have set the right environment variables, including email. When using the production ClusterIssuer, you might quickly run into problems if you try and fail too many times, causing letsencrypt to ignore you for a while."]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Note:"})," Consider setting up a ",(0,r.jsx)(t.a,{href:"/External-load-balancer",children:"separate load balancer"})," that also handles tls termination."]}),"\n",(0,r.jsxs)(t.p,{children:["First, Follow the steps in ",(0,r.jsx)(t.a,{href:"/First-deploy",children:"first-deploy"})]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Apply the manifest"}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"kubectl apply -f https://github.com/jetstack/cert-manager/releases/download/v1.11.0/cert-manager.yaml\n"})}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Wait until all pods are ready"}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"kubectl get pods --namespace cert-manager\n"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"NAME                                       READY   STATUS    RESTARTS   AGE\ncert-manager-7dd5854bb4-vtqjx              1/1     Running   0          42s\ncert-manager-cainjector-64c949654c-8b7md   1/1     Running   0          42s\ncert-manager-webhook-6bdffc7c9d-swgdj      1/1     Running   0          42s\n"})}),"\n",(0,r.jsx)(t.h3,{id:"letsencrypt-production-clusterissuer",children:"Letsencrypt Production ClusterIssuer"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"cat letsencrypt-prod.yaml | envsubst | kubectl apply -f -\n"})}),"\n",(0,r.jsxs)(n,{children:[(0,r.jsx)("summary",{children:"letsencrypt-prod.yaml"}),(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:'--8<-- "./manifests/letsencrypt-prod.yaml"\n'})})]}),"\n",(0,r.jsx)(t.p,{children:"Add the traefik https redirect middleware"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"cat traefik-https-redirect-middleware.yaml | envsubst | kubectl apply -f -\n"})}),"\n",(0,r.jsxs)(n,{children:[(0,r.jsx)("summary",{children:"traefik-https-redirect-middleware.yaml"}),(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:'--8<-- "./manifests/traefik-https-redirect-middleware.yaml"\n'})})]}),"\n",(0,r.jsx)(t.p,{children:"Add the whoami-tls-ingress.yaml"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"cat ./whoami/whoami-ingress-tls.yaml | envsubst | kubectl apply -f -\n"})}),"\n",(0,r.jsxs)(n,{children:[(0,r.jsx)("summary",{children:"whoami-ingress-tls.yaml  "}),(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:'--8<-- "./manifests/whoami/whoami-ingress-tls.yaml"\n'})})]}),"\n",(0,r.jsx)(t.h2,{id:"test",children:"Test"}),"\n",(0,r.jsxs)(t.p,{children:["point your browser to ",(0,r.jsx)("a",{href:"https://echo.dog.example.com",target:"_blank",children:(0,r.jsx)(t.a,{href:"https://echo.dog.example.com",children:"https://echo.dog.example.com"})}),' . (It might be a few minutes until certificates are ready). You should get a 200 response, and a simple response of "echo1" showing in the webpage. You should now see your whoami service served with a fresh https certificate.']}),"\n",(0,r.jsx)(t.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsxs)(t.p,{children:["Se cert-managers official ",(0,r.jsx)("a",{href:"https://cert-manager.io/docs/faq/acme/",target:"_blank",children:"trouble shooting guide"})]})]})}function h(e={}){const{wrapper:t}={...(0,s.a)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},1151:(e,t,n)=>{n.d(t,{Z:()=>l,a:()=>i});var r=n(7294);const s={},a=r.createContext(s);function i(e){const t=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),r.createElement(a.Provider,{value:t},e.children)}}}]);